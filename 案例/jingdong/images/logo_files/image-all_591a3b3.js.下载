define("file-widget-1:image/log.js",function(i,e,o){o.exports={mix:{show_imgLoad:{logType:"time",description:"浏览图片"},picpreview_face_search_click:{logType:"count",description:"点击人脸搜索按钮的次数"},picpreview_print_pic:{logType:"count",description:"点击云冲印按钮的次数"},picpreview_large_pic_click:{logType:"count",description:"点击放大按钮的次数"},picpreview_control_left_click:{logType:"count",description:"点击左旋转按钮的次数"},"picpreview_picpreview_control_share-click":{logType:"count",description:"点击分享按钮的次数"},picpreview_control_download_click:{logType:"count",description:"点击下载按钮的次数"},picpreview_control_edit_click:{logType:"count",description:"点击美化按钮的次数"},picpreview_control_delete_click:{logType:"count",description:"点击删除按钮的次数"},picpreview_control_reappear_click:{logType:"count",description:"点击图片详情按钮的次数"},picpreview_open_detail_click:{logType:"count",description:"点击打开图片详情的次数"},picpreview_close_detail_click:{logType:"count",description:"点击关闭图片详情的次数"},picpreview_open_directory_click:{logType:"count",description:"点击所属文件夹的次数"},picpreview_open_category_click:{logType:"count",description:"点击所属分类的次数"},picpreview_disk_home_click:{logType:"count",description:"用户从文件列表中预览图片的次数"},picpreview_timeline_click:{logType:"count",description:"用户从云图中预览图片的次数"},picpreview_bigPic_loadtime:{logType:"time",description:"大图预览的加载时长"},picpreview_livephoto_show:{logType:"count",description:"用户大图预览livephoto文件"},picpreview_livephoto_loading:{logType:"count",description:"预览livephoto文件播放视频开始加载"},picpreview_livephoto_playing:{logType:"count",description:"预览livephoto文件开始播放视频"},picpreview_livephoto_click_play_or_pause:{logType:"count",description:"预览livephoto文件点击播放或者点击暂停"},picpreview_livephoto_error:{logType:"count",description:"预览livephoto文件播放失败"},picpreview_livephoto_click_download:{logType:"count",description:"预览livephoto文件点击下载按钮"},picpreview_all_view_entry_show:{logType:"count",description:"全景图展现的埋点"},picpreview_all_view_click:{logType:"count",description:"点击全景图的埋点"},picpreview_all_view_close:{logType:"count",description:"点击全景图的埋点"},picpreview_all_view_error:{logType:"count",description:"\b展示入口且渲染发生错误的埋点"}}}});
;define("file-widget-1:image/context.js",function(e,n,t){var o={context:null,version:null},i=e("file-widget-1:image/log.js");t.exports={getContext:function(){return o.context},setContext:function(e){o.context=e,e.log&&e.log.define&&e.log.define(i)},getVersion:function(){return o.version},setVersion:function(e){o.version=e}}});
;define("file-widget-1:image/util/picPreview/picPreview.tpl.js",function(i,e,l){var p=[];p.push('<div node-type="dlg-hd" class="dlg-hd">'),p.push('    <a title="关闭" hideFocus=true id=<%=closeId%> class="dlg-img-ic dlg-img-close icon icon-picpre-close"></a>'),p.push("</div>"),p.push('<div node-type="img-title-right-mobile-box" class="img-title-right-mobile-box">'),p.push('<div node-type="img-title-right-open-mobile" class="img-title-right-open-mobile">'),p.push('    <span class="img-title-right-open-mobile-icon icon icon-sjck"></span>'),p.push('    <a class="img-title-right-open-mobile-gray" title="手机看">手机看</a>'),p.push("</div>"),p.push("</div>"),p.push('<div node-type="dlg-livephoto-control" class="dlg-livephoto-control">'),p.push('    <div node-type="livp-icon" class="livp-icon start-loading"></div>'),p.push('    <div node-type="livp-play-tip" class="livp-play-tip">'),p.push('        <p class="livp-tip-text"></p>'),p.push('        <div class="tip-triangle"></div>'),p.push("    </div>"),p.push("</div>"),l.exports=p.join("\n")});
;define("file-widget-1:image/util/picPreviewService/picPreviewService.js",function(t,e,i){var o=t("base:widget/libs/jquerypacket.js"),n=t("base:widget/libs/underscore.js"),r={HTTPVersion:"1.1",normalDomains:[],thumbsDomains:[]},a=window.host&&window.host.HOST_THUMBNAIL||"thumbnail.baidupcs.com",c=window.host&&window.host.HOST_PCS||"pcs.baidu.com",u=window.host&&window.host.HOST_D_PCS||"d.pcs.baidu.com",d=window.host&&window.host.HOST_PCS_DATA||"pcsdata.baidu.com",s={checkHttpVersion:function(){function t(){e.isReady=!0,n.isFunction(e.callback)&&e.callback()}var e={isReady:!1},i=window.host&&window.host.SOURCE_VALUE,o=Number(i);isNaN(o)&&(window.host&&(window.host.HOST_BAIDU_PCS="baidupcs.com"),o=10);for(var a=0;o>a;a++){var c=".";window.host&&window.host.HOST_BAIDU_PCS&&2===o&&(c="-"),r.thumbsDomains.push("thumbnail"+a+c+(window.host&&window.host.HOST_BAIDU_PCS||"baidupcs.com"))}t()},getIdleDomain:function(t){var e=0,i="normalDomains",o="thumbsDomains";if(t&&"2"===String(r.HTTPVersion))return"thumbnail.baidupcs.com"===a?"https://thumbnail10.baidupcs.com":"https://"+a;var n=t?o:i;return r[n][e++%10]},getProcessedSrc:function(t,e){if(t.indexOf("http")<0)return t;var i=c,o=u,n="thumbnail.baidupcs.com"===a?"thumbnail0.baidupcs.com":a,r="http:"===document.location.protocol;if(null!=t){var d=t.indexOf(o)>-1,h=t.indexOf(n)>-1;if(!d&&!h)return t;var p=d?o:n,l=o;return d&&r&&(l=s.getIdleDomain()),h&&(l=s.getIdleDomain(!0)),e&&(l=location.protocol+"//"+i),p!==l&&((l.indexOf("https://")>-1||e)&&(p=new RegExp("(http|https)://"+p)),t=t.replace(p,l)),t}},orientationFix:function(t){return"LeftTopOrientation"===t||"LeftBottomOrientation"===t||"RightBottomOrientation"===t||"RightTopOrientation"===t?!0:!1}};s.checkHttpVersion(),i.exports={getThumbnail:function(t,e,i){var i=i||100,e=o.extend({width:115,height:115},e),n=location.protocol+"//"+d+"/rest/2.0/pcs/thumbnail?method=generate&app_id=250528",r={path:t,width:e.width,height:e.height,quality:i};for(var a in r){var c=encodeURIComponent(r[a]);n+="&"+a+"="+c}return this.getProcessedSrc(n)},getThumbnailByFile:function(t,e,i,n){var r,n=n||90,e=o.extend({width:115,height:115},e);if(t&&t.thumb)r=t.thumb.replace(/\&quality\=(\d+)/,"&quality="+n).replace(/c\d+_u\d+/g,"c"+e.width+"_u"+e.height);else if(t&&t.thumbs){var a=t.thumbs.url3||t.thumbs.url2||t.thumbs.url1;r=a?a.replace(/\&quality\=(\d+)/,"&quality="+n).replace(/c\d+_u\d+/g,"c"+e.width+"_u"+e.height):this.getThumbnail(t.path,e,n)}else t&&(r=this.getThumbnail(t.path,e,n));return i&&(r=r+"&autopolicy="+i),this.getProcessedSrc(r)},getProcessedSrc:function(t){return s.getProcessedSrc(t)},getScript:function(t){var e=new o.Deferred;return o.ajax({url:t,cache:!0,dataType:"script"}).done(e.resolve).fail(e.reject),e},checkH5VideoSupport:function(){var t=function(){var t=document.createElement("video");try{t.volume=.5}catch(e){return!1}var i=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"];return Array.prototype.some&&i.some(function(e){return/maybe|probably/i.test(t.canPlayType(e))})}(),e=function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')}();return t||e},checkSpecialBrowser:function(){var t=window.navigator.userAgent;return window.ActiveXObject||"ActiveXObject"in window?"ie":/edge/i.test(t)?"edge":/AppleWebKit\/(\S+)/.test(t)&&!/Chrome\/(\S+)/.test(t)?"safari":"normal"}}});
;define("file-widget-1:image/util/showPic/showPic.tpl.js",function(i,e,s){var p=[];p.push('<div class="module-showPic clearfix">'),p.push('    <div node-type="img-wrap" class="img-wrap">'),p.push('        <div node-type="livp-video" class="livp-video"></div>'),p.push('        <img src="#" node-type="viewpic-image" id="viewpic-image"/>'),p.push('        <img src="#" node-type="viewpic-image-substitute" id="viewpic-image-substitute"/>'),p.push("    </div>"),p.push('    <div node-type="img-nav" class="img-nav">'),p.push('    <div node-type="img-nav-left" class="img-nav-left" hidefocus=true>'),p.push('        <span node-type="pre-arrow" class="pre-arrow">'),p.push('            <em class="pre-arrow-content icon icon-picpre-before"></em>'),p.push("        </span>"),p.push("    </div>"),p.push('    <div node-type="img-nav-right" class="img-nav-right" hidefocus=true>'),p.push('        <span node-type="next-arrow" class="next-arrow">'),p.push('            <em class="next-arrow-content icon icon-picpre-next"></em>'),p.push("        </span>"),p.push("        </div>"),p.push("    </div>"),p.push('    <div class="img-loading" node-type="img-loading"></div>'),p.push("</div>"),s.exports=p.join("")});
;define("file-widget-1:image/util/picPreviewAside/picPreviewAside.tpl.js",function(i,s,e){var d=i("file-widget-1:image/context.js"),p=d.getContext;e.exports=function(){var i=[],s=p().pageInfo.currentPage;if(/^share-/.test(s))i.push('<div node-type="module" class="module-picPreviewAside" id="picPreviewAside">'),i.push('     <div class="box" node-type="box">'),i.push('         <div class="file-info" node-type="file-info">'),i.push('                <div class="title" node-type="title">照片详情</div>'),i.push("                <div>"),i.push('                    <div style="margin-top: 60px">'),i.push('                        <div class="detail-left">文件名</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div node-type="filename" class="filename-info"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">大小</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div class="size-info" node-type="size"></div>'),i.push('                            <div class="size-info" node-type="capacity"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                <div class="retract-hide icon icon-picpre-close" node-type="retract"></div>'),i.push("        </div>"),i.push("     </div>"),i.push("</div>");else{i.push('<div node-type="module" class="module-picPreviewAside" id="picPreviewAside">'),i.push('     <div class="box" node-type="box">'),i.push('         <div class="file-info" node-type="file-info">'),i.push('                <div class="title" node-type="title">照片详情</div>'),i.push("                <div>"),i.push("                    <div>"),i.push('                        <div node-type="sculpture-top" class="detail-top">人脸</div>'),i.push('                        <div node-type="sculpture-box" class="sculpture-box">');for(var e=0;6>e;e++)i.push('                        <div node-type="human-sculpture" class="sculpture-item">'),i.push('                            <a class="sculpture-area" target="_blank">'),i.push('                                <img class="sculpture-img">'),i.push("                            </a>"),i.push("                        </div>");i.push("                        </div>"),i.push('                        <div node-type="category-top" class="detail-top">分类</div>'),i.push('                        <div node-type="category-box" class="category-box">');for(var e=0;3>e;e++)i.push('                        <div class="category-detail">'),i.push('                            <a class="category-detail-info" target="_blank"></a>'),i.push("                        </div>");i.push("                        </div>"),i.push("                    </div>"),i.push('                    <div class="filename-box">'),i.push('                        <div class="detail-left">文件名</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div node-type="filename" class="filename-info"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                    <div node-type="directory-box">'),i.push('                        <div class="detail-left-directory">所属文件夹</div>'),i.push('                        <div class="detail-right">'),i.push('                            <a node-type="directory" class="directory-info" target="_blank"></a>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">地点</div>'),i.push('                        <div class="detail-right">'),i.push('                                <a node-type="address" class="address-info" target="_blank"></a>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">时间</div>'),i.push('                        <div class="detail-right">'),i.push('                             <div node-type="date-pre" class="date-pre"></div>'),i.push('                             <div node-type="date-after" class="date-after"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">大小</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div class="size-info" node-type="size"></div>'),i.push('                            <div class="size-info" node-type="capacity"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                <div class="retract-hide icon icon-picpre-close" node-type="retract"></div>'),i.push("        </div>"),i.push("     </div>"),i.push("</div>")}return i.join("\n")}});
;define("file-widget-1:image/util/thumbnailPic/thumbnailPic.tpl.js",function(e,t,o){var i=[];i.push('<div class="module-thumbnailPic">'),i.push('<div class="operate-area" node-type="operate-area">'),i.push('<div class="operate-container" node-type="operate-container">'),i.push('                  <div node-type="print-pic" class="print-pic icon">'),i.push('                      <span class="print-pic-icon"></span>'),i.push('                      <em class="print-pic-title">全景浏览</em>'),i.push("                  </div>"),i.push('                  <div node-type="print-pic-new" class="print-pic icon">'),i.push('                      <span class="print-pic-new-icon"></span>'),i.push('                      <em class="print-pic-title">云冲印</em>'),i.push("                  </div>"),i.push('                  <div class="img-control" node-type="img-control">');var s='<svg width="22" height="22" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.9642 14.8052H17.6434M17.6434 14.8052L15.1023 11.9658M17.6434 14.8052L15.1023 17.6503M2.33325 17.2669C2.33325 19.9891 4.19476 22.2577 6.82109 22.7622C6.93934 22.7849 7.05999 22.7938 7.1804 22.7942L20.9996 22.8425C23.5316 22.5772 25.6666 20.1822 25.6666 17.2669C25.6666 14.57 23.8396 12.3183 21.5619 11.7864C21.5063 11.7734 21.4663 11.724 21.4666 11.6669C21.4666 7.6476 18.1236 4.2002 13.9999 4.2002C9.87619 4.2002 6.53325 7.6476 6.53325 11.6669L6.53362 11.7508C6.53426 11.7997 6.50091 11.8424 6.45367 11.8548C4.02283 12.4916 2.33325 14.6734 2.33325 17.2669Z" stroke="currentColor" stroke-opacity="1" stroke-width="1.98333" stroke-linecap="round" stroke-linejoin="round"/></svg>',n='<svg node-type="save-to-mine-close" style="vertical-align: middle;" width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.25 4L11.75 12.5M11.75 4.00002L3.25001 12.5" stroke="white" stroke-opacity="0.7" stroke-width="1.3" stroke-linecap="round"/></svg>',p='<div class="tip-triangle"></div>',l='<div node-type="save-to-mine-hover" class="img-save-guide-hover"><span>图片未保存，链接失效将无法查看</span>'+n+p+"</div>";i.push('                      <em node-type="save-to-mine" class="control control-left icon icon-save-to-mine" title="保存">'+s+l+"</em>"),i.push('                      <em node-type="large-pic" class="control control-left icon icon-picpre-enlarge" title="放大"></em>'),i.push('                      <em node-type="control-left" class="control control-left icon icon-picpre-rotate icon-icon-picpre-rotate" title="左旋转"></em>'),i.push('                      <em node-type="control-share" class="control control-share icon icon-my-share" title="分享给好友"></em>'),i.push('                      <em node-type="control-download" class="control control-download icon icon-picpre-download" title="下载图片"></em>'),i.push('                      <em node-type="control-edit" class="control control-edit icon icon-picpre-beautify" title="美化图片"></em>'),i.push('                      <em node-type="control-delete" class="control control-delete icon icon-picpre-delete" title="删除图片"></em>'),i.push('                      <em node-type="control-reappear" class="control control-reappear icon icon-picpre-detail" title="图片详情">'),i.push('                          <div node-type="img-detail-tip" class="img-detail-tip">图片详情在这里哦～<div node-type="tip-triangle" class="tip-triangle"></div></div>'),i.push("                      </em>"),i.push("                  </div>"),i.push('                  <div node-type="show-thumb" class="show-thumb">'),i.push('                      <em class="show-thumb-title" node-type="show-thumb-title">展开缩略图</em>'),i.push('                      <em class="icon icon-picpre-pullup show-thumb-icon" node-type="show-thumb-icon"></em>'),i.push("                  </div>"),i.push("</div>"),i.push("</div>"),i.push('<div class="thumb-wrap" node-type="thumb-wrap">'),i.push('<ol node-type="thumb-list" class="thumb-list">'),i.push("</ol>"),i.push("</div>"),i.push("</div>"),o.exports=i.join("\n")});
;define("file-widget-1:image/util/showPic/log.js",function(e,o,i){function a(e,o){if(o||(o={}),e){var i=n[e];i.ext=o,t.sendLog(i)}}var n={commonBase:{serverId:19005,from:"image",page:"photo_view_page",parasitifer:"web",appname:"wangpan"},imgPlayerDis:{type:"display",value:"photo_view_dis",comment:"图片预览器展现"},saveImgGuideDis:{type:"clk",value:"save_photo_guide",comment:"保存按钮引导展现"},saveImgGuideCloseClk:{type:"clk",value:"save_photo_guide_close",comment:"保存按钮引导点击关闭"},saveImgClk:{type:"clk",value:"save_photo_clk",comment:"点击转存"}},s=window.BpData;s||(s=function(){},s.prototype.sendLog=function(){});var t=new s(n.commonBase);i.exports={sendlog:function(e,o){setTimeout(function(){a(e,o)},0)},getCommonLogParam:function(e){var o=window.locals.get("file_list")||[];return{user_type:1===window.locals.get("is_svip")?"svip":0===window.locals.get("is_vip")?"norm":"other",is_login:window.locals.get("loginstate"),share_id:window.locals.get("shareid"),share_name:o.length?o[0].server_filename:"",is_one:1===o.length?1:0,link_share_uk:window.locals.get("share_uk"),fsid:e.fs_id,md5:e.md5,file_name:e.server_filename,file_path:e.path}}}});
;define("file-widget-1:image/util/allViewPic/allViewPic.js",function(e,i,t){function o(i,t,o){var a=['<div id="all-view-container">','   <div class="all-view-close-btn" node-type="all-view-close-btn"></div>',"</div>"].join("");o("body").append(a);var n;try{r=e("base:thirdParty/pangl/pangl.js"),n=r.pictureFakeVRViewer({target:"all-view-container",downGrade:i,params:{imgSrc:i}})}catch(c){s=!0,n&&n.destroy&&n.destroy(),o("#all-view-container").remove(),l.getContext().log.send({type:"picpreview_all_view_error",errorMsg:c,imgName:t.server_filename,imgWidth:t.width||t.resolution.match(/width\:(\d+)/)[1],imgHeight:t.height||t.resolution.match(/height\:(\d+)/)[1],size:t.size})}var d=o('div[node-type="all-view-close-btn"]');d.on("click",function(){n&&n.destroy&&n.destroy(),o("#all-view-container").remove(),l.getContext().log.send({type:"picpreview_all_view_close",imgName:t.server_filename,imgWidth:t.width||t.resolution.match(/width\:(\d+)/)[1],imgHeight:t.height||t.resolution.match(/height\:(\d+)/)[1],size:t.size})})}function a(e){for(var i=e.thumbUrl,t=i.split("?")[1].split("&"),o={},a="",l=0;l<t.length;l++){var n=t[l].split("=")[0],r=t[l].split("=")[1];o[n]=r}"1"!==o.useraw&&(o.useraw="1"),"c1600_u1600"!==o.size&&(o.size="c1600_u1600"),"1"!==o.autopolicy&&(o.autopolicy="1");for(var s in o)a+="&"+s+"="+o[s];return i.split("?")[0]+"?"+a.slice(1)}var l=e("file-widget-1:image/context.js"),n="https://nd-static.bdstatic.com/m-static/base/thirdParty/pangl/_nomd5_nomod/pangl.js",r=null,s=!1;t.exports=function(e){var i=l.getContext().libs.$,t=a(e);return s?void 0:r?void o(t,e,i):void i.loadScript(n,function(){o(t,e,i)},function(){s=!0})}});
;define("file-widget-1:image/util/showPic/printPic.tpl.js",function(i,p,c){var d='<div class="print-pic-body">    <div>        <div class="print-pic-qr-code">            <div class="print-pic-qr-code-img"></div>        </div>        <div class="print-pic-scan"></div>    </div>    <p class="print-pic-tip">享更多云冲印优惠，用最新版百度网盘App扫码</p></div>';c.exports=d});
;define("file-widget-1:image/util/showPic/showPic.js",function(e){function i(){return"livePhotoConf_"+l().locals.get("uk")}function t(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(i){return!1}}function o(){var e={},o={},u=l().ui.loading({container:r(".img-loading"),text:!1,size:26}),v=function(){o.addEvent(),o.transformSupport=o.css3Support("transform")};o.q={mod:"div.module-showPic",imgWrap:'div[node-type="img-wrap"]',imgNav:'div[node-type="img-nav"]',livpVideo:'div[node-type="livp-video"]',viewpic:'img[node-type="viewpic-image"]',viewpicSub:'img[node-type="viewpic-image-substitute"]',imgNavLeft:'div[node-type="img-nav-left"]',preArrow:'span[node-type="pre-arrow"]',imgNavRight:'div[node-type="img-nav-right"]',nextArrow:'span[node-type="next-arrow"]',imgLoader:'div[node-type="img-loader"]',operateArea:'div[node-type="operate-area"]',faceSearch:'div[node-type="face-search"]',thumbnailPic:"div.module-thumbnailPic",detailTip:'div[node-type="img-detail-tip"]'},o.$q={$mod:r(o.q.mod),$imgWrap:r(o.q.mod).find(o.q.imgWrap),$livpVideo:r(o.q.mod).find(o.q.livpVideo),$viewpic:r(o.q.mod).find(o.q.viewpic),$viewpicSub:r(o.q.mod).find(o.q.viewpicSub),$imgNavLeft:r(o.q.mod).find(o.q.imgNavLeft),$preArrow:r(o.q.mod).find(o.q.preArrow),$imgNavRight:r(o.q.mod).find(o.q.imgNavRight),$nextArrow:r(o.q.mod).find(o.q.nextArrow),$imgLoader:r(o.q.mod).find(o.q.imgLoader),$operateArea:r(o.q.mod).find(o.q.operateArea),$thumbnailPic:r(o.q.thumbnailPic),$detailTip:r(o.q.detailTip)},o.defaultSize={width:window.screen.width,height:window.screen.height},o.thumbSize={width:256,height:256},o.largeSize={width:1e4,height:1e4},o.defaultErrorSize={width:128,height:128},o.paddingWidth=120,o.paddingHeight=20,o.H5VideoSupport=c.checkH5VideoSupport(),o.checkBrowser=c.checkSpecialBrowser(),o.isLivePhoto=!1,o.isLivePhotoLoading=!1,o.livePhotoRetryTimer=null,o.livePlayer=null,o.size={},o.viewpicsubSize={},o.timelineFlag=!1,o.file={},o.len=0,o.rotate=0,o.defaultErrorPicUrl="/yun-static/common/images/default_128.gif",o.defaultPicUrl="/yun-static/common/images/default.gif",o.css3Support=function(e){var i=document.createElement("div"),t="Khtml O Moz Webkit".split(" "),o=t.length;if(e in i.style)return!0;if("-ms-"+e in i.style)return!0;for(e=e.replace(/^[a-z]/,function(e){return e.toUpperCase()});o--;)if(t[o]+e in i.style)return!0;return!1},o.resolvModSize=function(e){o.$q.$mod.width(e.width()-o.paddingWidth),o.$q.$mod.height(e.height()-o.paddingHeight)},o.showPicture=function(e){o.recordData(e),o.controlNavButton();var t;try{t=r.parseJSON(d.getItem(i()))||{}}catch(n){t={}}if(o.isLivePhoto&&o.H5VideoSupport&&0!==+t.autoPlay&&!/ie|edge/.test(o.checkBrowser)&&o.playCurrentLiveVideo(e.file),o.showCurrentPic(e.file),e.file.server_filename||(e.file.server_filename=e.file.moreInfo.fileName),e.file.fs_id){var a="share"===l().pageInfo.currentProduct,c=r('[node-type="img-title-right-open-mobile"]');if(e.file.share+""=="1"||a)c.hide();else{var s=window.host&&window.host.HOST_PAN||"pan.baidu.com",h=null;c.show(),c.off("mouseenter"),c.off("mouseleave"),c.mouseenter(function(){h=l().ui.qcodeDialog({width:"490px",show:!0,currentTarget:".img-title-right-open-mobile-gray",fileParams:e.file,imageUrl:"https://"+s+"/api/qrcode/openfile?fsid="+e.file.fs_id,position:{dgtop:"24px",dgleft:"-390px",trleft:"430px"},dialogType:"aside",logName:"picQcodeShow",logValue:"扫码消费文件图片大图页二维码生成次数"}),h.show()}).mouseleave(function(){h.hide(),h.destroy()})}}},o.controlNavButton=function(){1===+o.len?(o.$q.$imgNavRight.hide(),o.$q.$imgNavLeft.hide()):(o.$q.$imgNavLeft.css("display","inline"),o.$q.$imgNavRight.css("display","inline"))},o.recordData=function(e){if(o.index=e.index,o.file=e.file,o.len=e.len,e.file.resolution&&e.file.orientation){o.timelineFlag=!0;for(var i=e.file.resolution.split(","),t=[],n={},r=0;r<i.length;r++)t.push(i[r].match(/\d+/g));var a=t[0],l=t[1];if(("LeftTopOrientation"===e.file.orientation||"LeftBottomOrientation"===e.file.orientation||"RightBottomOrientation"===e.file.orientation||"RightTopOrientation"===e.file.orientation)&&a>l){var c=a;a=l,l=c}n.width=a,n.height=l,o.viewpicsubSize=o.calculateViewpicsubSize(n)}},o.imgArea=function(){o.size=o.resolvImgSize(o.file),o.size&&o.layoutImg(o.size)},o.sameProportion=function(e,i){if(!i.width||!i.height)return null;var t=i.width/i.height,o=i.width/e.width,n=i.height/e.height;return 1>=o&&1>=n?e={width:i.width,height:i.height}:o>=n?e={width:e.width,height:parseInt(e.width/t)}:n>=o&&(e={width:parseInt(e.height*t),height:e.height}),e},o.layoutImg=function(e){if(e){var i=o.isLivePhoto?[o.$q.$viewpic,o.$q.$livpVideo]:[o.$q.$viewpic];i.forEach(function(i){i.css({top:parseInt((o.$q.$mod.height()-e.height)/2,10),left:parseInt((o.$q.$mod.width()-e.width)/2,10),width:e.width,height:e.height})})}},o.layoutImgSub=function(e){e&&o.$q.$viewpicSub.css({top:parseInt((o.$q.$mod.height()-e.height)/2,10),left:parseInt((o.$q.$mod.width()-e.width)/2,10),width:e.width,height:e.height})},o.resolvImgSize=function(e){var i={width:o.$q.$mod.width(),height:o.$q.$mod.height()},t=o.sameProportion(i,{width:e.width,height:e.height});return t},o.calculateViewpicsubSize=function(e){var i={width:o.$q.$mod.width(),height:o.$q.$mod.height()},t=o.sameProportion(i,{width:e.width,height:e.height});return t},o.resetLivePlayer=function(){clearTimeout(o.livePhotoRetryTimer),o.livePhotoRetryTimer=null,o.livePlayer&&o.livePlayer.pause()&&o.livePlayer.off("timeupdate"),o.livePlayer=null,o.isLivePhotoLoading=!1,o.$q.$livpVideo.html("").hide().removeClass("active").css("visibility","visible")},o.playCurrentLiveVideo=function(e){if(void 0!==e&&/\.livp$/.test(e.path)){var t=(new Date).getTime();o.isLivePhotoLoading=!0,clearTimeout(o.livePhotoRetryTimer),o.livePhotoRetryTimer=null;var n=function(){if(o.isLivePhotoLoading){var c="application/x-mpegURL",s="M3U8_AUTO_480",h="livp-video-element",g=/ie|edge/.test(o.checkBrowser)?" ":"loop ",p=/safari/.test(o.checkBrowser)?"muted ":" ",u=location.protocol+"//"+location.host+"/api/streaming?path="+encodeURIComponent(e.path)+"&app_id=250528&clienttype=0&type="+s+"&vip="+a.getVipValue(),v=['<video id="'+h+'" ','class="video-js vjs-default-skin" ',g,p,"autoplay>",'<source src="'+u+'"','type="'+c+'">',"</video>"].join("");o.$q.$livpVideo.html(v),o.livePlayer=window.videojs(h,{techOrder:["html5"],hideLoadingSpinner:!0}),o.livePlayer.controls(!1),o.livePlayer.volume(.3);var f=function(){if(o.livePlayer&&o.livePlayer.currentTime&&o.isLivePhotoLoading){var e=o.livePlayer.currentTime();if(0!==+e){o.isLivePhotoLoading=!1,o.livePlayer.off("timeupdate",f),o.$q.$livpVideo.show().addClass("active").css("visibility","visible"),o.triggerEvent("update_livp_control_button","play_from_loading");var n=(new Date).getTime();l().log.send({type:"picpreview_livephoto_playing",category:"time",cost_time:n-t});var a;try{a=r.parseJSON(d.getItem(i()))||{}}catch(c){a={}}1!==+a.hideButtonTip&&o.triggerEvent("update_livp_control_button","show-play-tip")}}};o.livePlayer.on("timeupdate",f),o.livePlayer.on("error",function(){o.livePhotoRetryTimer?(o.triggerEvent("update_livp_control_button","error"),o.$q.$livpVideo.removeClass("active"),l().ui.tip({mode:"caution",msg:"实况照片加载失败",autoClose:!0,hasClose:!1}),l().log.send({type:"picpreview_livephoto_error"})):o.livePhotoRetryTimer=setTimeout(function(){n()},4e3)}),/ie|edge/.test(o.checkBrowser)&&o.livePlayer.on("ended",function(){o.triggerEvent("update_livp_control_button","loaded-and-not-play"),o.$q.$livpVideo.removeClass("active")}),l().log.send({type:"picpreview_livephoto_loading"})}};window.videojs?n():c.getScript(p+"video.js").then(function(){return c.getScript(p+"videojs-contrib-hls.js")}).then(function(){n()})}},o.showCurrentPic=function(e){if(void 0!==e){var i=c.getThumbnailByFile(e,o.defaultSize,1),t=c.getThumbnailByFile(e,o.thumbSize),n=o.loadImg({url:t,flag:!0}),a=o.loadImg({url:i,flag:!0,callback:function(){o.file.width=this.width,o.file.height=this.height}}),d=function(e,i,t){t?(o.$q.$viewpic.css("visibility","hidden"),o.layoutImgSub(o.viewpicsubSize),r(o.q.mod).find(o.q.viewpicSub).attr("src",i),r(o.q.mod).find(o.q.viewpic).attr("src",e)):(o.$q.$viewpic.css("visibility","hidden"),o.layoutImgSub(o.viewpicsubSize),r(o.q.mod).find(o.q.viewpicSub).attr("src",i),o.$q.$viewpicSub.css("visibility","visible"))};if(a)o.clearRotate(),o.imgArea(),d(i,t,!0);else if(n&&o.timelineFlag){o.loadStartTime=(new Date).getTime(),d(i,t,!1);var s=function(e,i){e.index===o.index&&(i===!0?(o.file.width=this.width,o.file.height=this.height,o.clearRotate(),o.imgArea(),o.$q.$viewpic.attr("src",e.url)):(o.file.width=o.defaultErrorSize.width,o.file.height=o.defaultErrorSize.height,o.clearRotate(),o.imgArea(),o.$q.$viewpic.attr("src",o.defaultErrorPicUrl)))};o.loadImg({callback:s,url:i,index:o.index})}else{o.loadStartTime=(new Date).getTime(),"hidden"!==o.$q.$viewpicSub.css("visibility")&&o.$q.$viewpicSub.css("visibility","hidden"),"hidden"!==o.$q.$viewpic.css("visibility")&&o.$q.$viewpic.css("visibility","hidden"),u.show();var s=function(e,i){e.index===o.index&&(1==i?(o.file.width=this.width,o.file.height=this.height,o.clearRotate(),o.imgArea(),d(e.url,e.urlSub,!0)):(o.file.width=o.defaultErrorSize.width,o.file.height=o.defaultErrorSize.height,o.clearRotate(),o.imgArea(),d(o.defaultErrorPicUrl,o.defaultErrorPicUrl,!0),o.isLivePhoto&&(o.resetLivePlayer(),o.triggerEvent("update_livp_control_button","hide"))))};o.loadImg({callback:s,url:i,urlSub:t,index:o.index})}o.picpreStatistic(),l().message.trigger("send_preview_log")}},o.loadImg=function(e){var i=(new Date).getTime()+"_preloadImg";window[i]=new Image;var t=window[i];return t.src=e.url,e.flag?t.complete||t.width>0&&t.height>0?(window[i]=null,"function"==typeof e.callback&&e.callback.call(t),!0):(window[i]=null,!1):t.complete?("function"==typeof e.callback&&e.callback.call(t,{url:e.url,urlSub:e.urlSub,index:e.index},!0),void(window[i]=null)):(t.onload=function(){o.loadTime=(new Date).getTime()-o.loadStartTime,"function"==typeof e.callback&&e.callback.call(t,{url:e.url,urlSub:e.urlSub,index:e.index},!0),l().log.send({name:"show_imgLoad",sendServerLog:!1,value:o.loadTime}),l().log.send({url:"//update.pan.baidu.com/statistics",op:"loadImage",type:"ignore",other0:"big",other1:"false",other2:1,other3:o.loadTime,other4:!1,other5:"webtimeline"}),t.onload=null,window[i]=null},void(t.onerror=function(){"function"==typeof e.callback&&e.callback.call(t,{url:e.url,urlSub:e.urlSub,index:e.index},!1),t.onload=null,window[i]=null}))},o.changePic=function(e){o.triggerEvent("change_picture",e)},o.sendPreviewLog=function(e,i){var t=l(),n="disk-home"===t.pageInfo.currentPage?1:0,r=0,a=0;if(n){var c=t.router.currentRouteName,d=t.router.query.get("type");a="category"===c&&"3"===d}else r=window.location.href.indexOf("/disk/timeline")>=0?1:0;t.log.send({type:"picpreview-successed-analyties",ctime:i.server_ctime||0,fsid:i.fs_id,md5:i.md5,flagdiskhome:n,flagnearupload:a,flagtimeline:r,timeCost:o.loadTime||0,flagAsideSelectedPic:0,pageurl:encodeURIComponent(window.location.href),sendPageFrom:!0})},o.picpreStatistic=function(){var e="/disk/home"===window.location.pathname?1:0,i="/disk/timeline"===window.location.pathname?1:0;e?l().log.send({type:"picpreview_disk_home_click"}):i&&l().log.send({type:"picpreview_timeline_click"})},o.clearRotate=function(){var e=[o.$q.$viewpic,o.$q.$livpVideo];e.forEach(function(e){e.removeClass("rotate"),e.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation=0)"),e.css("msfilter","progid:DXImageTransform.Microsoft.BasicImage(rotation=0)"),e.css({transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)"})}),o.rotate=0},o.deleteSuccess=function(e,i,t){if(1===e){var n=t.errno,r=i;102===n&&t.info&&t.info[0]&&t.info[0].errno&&(n=102===t.info[0].errno?"-102":t.info[0].errno,r=l().errorMsg(n,r)),l().ui.tip({mode:"caution",msg:r,hasClose:!0,autoClose:!0})}else o.triggerEvent("delete_picPreview",{callback:function(e){return 1===o.file.length?(o.triggerEvent("close_picPreview_dialog"),!0):void o.triggerEvent("delete_picture",{list:e,index:o.index})},index:o.index,file:o.file})},o.saveToMine=function(){var e=o.file;g.sendlog("saveImgClk",g.getCommonLogParam(e)),l().message.callPlugin("保存到网盘@com.baidu.pan.share",{filesList:[e],isFileConsumeScene:!0})},o.largePic=function(){var e=o.file,i=c.getThumbnailByFile(e,o.largeSize);window.open(i)},o.checkFaceSreach=function(){var e=r(o.q.faceSearch);"undefined"==typeof o.file.faceinfo?r.get("/api/image/faceinfo",{fid:o.file.fs_id},function(i){i=r.parseJSON(i),i&&0===i.errno?i.faceinfo&&i.faceinfo.length>0&&i.faceinfo[0].face&&i.faceinfo[0].face.length>0?(o.file.faceinfo=!0,e.css("display","block")):(o.file.faceinfo=!1,e.css("display","none")):e.css("display","none")}).error(function(){e.css("display","none")}):o.file.faceinfo?e.css("display","block"):e.css("display","none")},o.clickFaceSearch=function(){window.open("/disk/facesearch?fsid="+o.file.fs_id),l().log.send({type:"timeline_facesearch_search",pageurl:encodeURIComponent(window.location.href),picpreview:1})},o.printPic=function(){var e=o.file;if(!t())return void l().ui.tip({mode:"caution",msg:"当前浏览器不支持全景图片预览",hasClose:!0,autoClose:!0});try{s(e)}catch(i){l().log.send({type:"picpreview_all_view_error",errMsg:i,imgName:e.server_filename,imgWidth:e.width||e.resolution.match(/width\:(\d+)/)[1],imgHeight:e.height||e.resolution.match(/height\:(\d+)/)[1],size:e.size})}l().log.send({type:"picpreview_all_view_click",imgName:e.server_filename,imgWidth:e.width||e.resolution.match(/width\:(\d+)/)[1],imgHeight:e.height||e.resolution.match(/height\:(\d+)/)[1],size:e.size})},o.printPicNew=function(){if(n&&n.show)return void n.show();var e=l(),i=e.ui.alert,t={className:"picpreview-print-pic-new",body:h,width:"480px"};n=i(t)},o.controlToolBar=function(e){e===!0?o.controlNavButton():(o.$q.$imgNavLeft.css("display","none"),o.$q.$imgNavRight.css("display","none"))},o.controlRotate=function(e){var i,t=[o.$q.$viewpic,o.$q.$livpVideo],n={width:o.$q.$viewpic.width(),height:o.$q.$viewpic.height()},r={width:o.$q.$imgWrap.width(),height:o.$q.$imgWrap.height()};if("#"!=o.$q.$viewpic.attr("src"))if(o.rotate+=e,n.width>r.height&&o.rotate%2?(i=o.sameProportion(r,{width:n.height,height:n.width}),i={width:i.height,height:i.width}):i=o.sameProportion(r,{width:o.file.width,height:o.file.height}),o.layoutImg(i),o.transformSupport)t.forEach(function(e){e.addClass("rotate"),e.css({transform:"rotate("+90*o.rotate+"deg)","-webkit-transform":"rotate("+90*o.rotate+"deg)","-moz-transform":"rotate("+90*o.rotate+"deg)","-o-transform":"rotate("+90*o.rotate+"deg)","-ms-transform":"rotate("+90*o.rotate+"deg)"})});else{var a=parseInt(o.rotate)>0?parseInt(o.rotate)%4:parseInt(o.rotate)%4+4;t.forEach(function(e){e.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+a+")"),e.css("msfilter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+a+")"),a%2?e.css({top:(o.$q.$imgWrap.height()-e.height())/2-10,left:(o.$q.$imgWrap.width()-e.width())/2}):o.layoutImg(i)})}},o.controlShare=function(){var e=o.file;l().message.callPlugin("网盘分享@com.baidu.pan",{filesList:[e]})},o.downloadFunc=null,o.controlDownload=function(){var e=o.file;/\.livp$/.test(e.path)&&l().log.send({type:"picpreview_livephoto_click_download"}),"function"==typeof o.downloadFunc?o.downloadFunc(o.file):l().message.callPlugin("网盘下载@com.baidu.pan",{filesList:[e]})},o.controlEdit=function(){var e=o.file;l().message.callPlugin("美图秀秀@com.meitu",{filesList:[e]})},o.controlDelete=function(){l().message.callPlugin("网盘文件删除@com.baidu.pan",{filesList:o.file,callback:o.deleteSuccess,sync:!0})},o.controlReappear=function(){l().message.trigger("resolve_aside_visible"),o.$q.$detailTip.hide(),d.getItem("picDetailTip")||d.setItem("picDetailTip",!0)},o.addEvent=function(){l().message.listen("operate_button",function(e){switch(e){case"save-to-mine":o.saveToMine();break;case"large-pic":o.largePic();break;case"face-search":o.clickFaceSearch();break;case"print-pic":o.printPic();break;case"print-pic-new":o.printPicNew();break;case"control-left":o.controlRotate(-1);break;case"control-share":o.controlShare();break;case"control-download":o.controlDownload();break;case"control-edit":o.controlEdit();break;case"control-delete":o.controlDelete();break;case"control-reappear":o.controlReappear()}var i=function(e){var i=(e||"").split("-"),t=i.join("_");return t};l().log.send({type:"picpreview_"+i(e)+"_click"})}),o.preOrNextPic(),o.initListenEvent(),o.loadingCompensate()},o.preOrNextPic=function(){o.$q.$mod.delegate(o.q.imgNavLeft,"click",function(){o.changePic(-1)}),o.$q.$mod.delegate(o.q.imgNavRight,"click",function(){o.changePic(1)}),o.$q.$mod.bind("mouseenter",function(){o.controlToolBar(!0)}),o.$q.$mod.bind("mouseleave",function(){o.controlToolBar(!1)}),o.$q.$imgNavLeft.on("mouseenter",function(){o.$q.$preArrow.addClass("pre-arrow-hover")}),o.$q.$imgNavLeft.on("mouseleave",function(){o.$q.$preArrow.removeClass("pre-arrow-hover")}),o.$q.$imgNavRight.on("mouseenter",function(){o.$q.$nextArrow.addClass("next-arrow-hover")}),o.$q.$imgNavRight.on("mouseleave",function(){o.$q.$nextArrow.removeClass("next-arrow-hover")})},o.loadingCompensate=function(){o.$q.$viewpic.load(function(){"none"!==r(".img-loading").css("display")&&u.hide(),o.$q.$viewpicSub.css("visibility","hidden"),o.$q.$viewpicSub.attr("src","#"),o.$q.$viewpic.css("visibility","visible")}),o.$q.$viewpicSub.load(function(){"none"!==r(".img-loading").css("display")&&u.hide(),o.$q.$viewpicSub.css("visibility","visible")})},o.triggerEvent=function(e,i){l().message.trigger(e,i)},o.listenEvent=function(e,i){l().message.listen(e,i)};var f="show",m="hide";o.resolveControls=function(e){e=e||{},o.$q.$mod.find(o.q.printPic)[e.print?m:f](),o.$q.$mod.find(o.q.controlShare)[e.share?m:f](),o.$q.$mod.find(o.q.controlDownload)[e.download?m:f](),o.$q.$mod.find(o.q.controlEdit)[e.edit?m:f](),o.$q.$mod.find(o.q.controlDelete)[e.del?m:f](),e.hideAside&&o.triggerEvent("resolve_aside_visible",null)},o.replaceDownloadFunc=function(e){o.downloadFunc="function"==typeof e?e:null},o.initListenEvent=function(){o.listenEvent("resize_showPic",function(e){o.resolvModSize(e.imgDialogBd),o.imgArea()}),o.listenEvent("img_showPic",function(e){o.isLivePhoto=/\.livp$/.test(e.file.path)?!0:!1,o.isLivePhoto&&o.$q.$detailTip.hide(),o.isLivePhoto&&l().log.send({type:"picpreview_livephoto_show"}),o.resetLivePlayer(),o.showPicture(e),o.triggerEvent("clean_detail_humanCover",{isClean:!0}),o.triggerEvent("update_livp_control_button",o.isLivePhoto?o.H5VideoSupport?o.isLivePhotoLoading?"show-loading":"show-not-loading":"not-support":"hide");var t;try{t=r.parseJSON(d.getItem(i()))||{}}catch(n){t={}}1===+t.hideButtonTip&&o.triggerEvent("update_livp_control_button","hide-play-tip"),1===+t.hideButtonTip?o.triggerEvent("update_livp_control_button","hide-play-tip"):o.isLivePhoto&&/ie|edge/.test(o.checkBrowser)&&o.H5VideoSupport?o.triggerEvent("update_livp_control_button","show-play-tip"):o.isLivePhoto&&!o.H5VideoSupport&&o.triggerEvent("update_livp_control_button","not-support-tip")}),o.listenEvent("click_livp_control",function(e){switch(e){case"stopLoading":o.resetLivePlayer();break;case"startLoading":o.playCurrentLiveVideo(o.file);break;case"livpPlay":o.livePlayer&&o.livePlayer.play(),o.$q.$livpVideo.addClass("active");break;case"livpPause":o.$q.$livpVideo.removeClass("active"),o.livePlayer&&o.livePlayer.pause()}}),o.listenEvent("close_picPreview_success",function(){o.resetLivePlayer(),o.$q.$viewpic.attr("src","#"),o.$q.$viewpic.css("width","100%"),o.$q.$viewpic.css("height","100%")}),o.listenEvent("resolve_pic_controls",function(e){o.resolveControls(e)}),o.listenEvent("replcae_download_function",function(e){o.replaceDownloadFunc(e.downloadFunc)}),o.listenEvent("send_preview_log",function(){o.sendPreviewLog(1,o.file)}),o.listenEvent("thumbnailPic_up_down",function(e){o.triggerEvent("thumbnailPic_toggle",e),o.resolvModSize(r('div[node-type="dlg-bd"]')),o.imgArea()})},v.apply(e,arguments)}var n,r=e("base:widget/libs/jquerypacket.js"),a=e("base:widget/vip/vip.js"),l=e("file-widget-1:image/context.js").getContext,c=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),d=e("base:widget/storage/storage.js"),s=e("file-widget-1:image/util/allViewPic/allViewPic.js"),h=e("file-widget-1:image/util/showPic/printPic.tpl.js"),g=e("file-widget-1:image/util/showPic/log.js"),p="https://nd-static.bdstatic.com/m-static/base/thirdParty/videojs/_nomd5_nomod/";o()});
;define("file-widget-1:image/util/picCategory/picCategoryMap.js",function(e,o,p){var t={};t.toNum={people:256,people_one:257,people_two:258,people_three:259,people_more:260,animal:512,plant:768,landscape:1024,building:1280,building_indoor:1281,building_outdoor:1282,transport:1536,food:1792,screenshot:2304,other:2048},t.toStr={256:"people",257:" people_one",258:"people_two",259:"people_three",260:"people_more",512:"animal",768:"plant",1024:"landscape",1280:"building",1281:"building_indoor",1282:"building_outdoor",1536:"transport",1792:"food",2048:"other"},t.toCN={257:"单人",258:"双人",259:"三人",260:"多人",768:"植物",1024:"自然风景",1281:"室内建筑",1282:"室外建筑",1536:"交通工具",512:"动物",1792:"食物",2048:"其他"},p.exports=t});
;define("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js",function(t,e,a){function i(t){this.dialog=null,this.files=t,this.init()}var s=t("base:widget/libs/jquerypacket.js"),l=t("file-widget-1:image/context.js").getContext,o=t("file-widget-1:image/util/picCategory/picCategoryMap.js"),c=['<div class="content">',"<ul class='category_list global-clearfix'>",'<li data-key="people_one"><a href="javascript:;" class=\'cluster selected\'>单人</a>',"</li>",'<li data-key="people_two"><a href="javascript:;" class=\'cluster\'>双人</a>',"</li>",'<li data-key="people_three"><a href="javascript:;" class=\'cluster\'>三人</a>',"</li>",'<li data-key="people_more" class="content_right"><a href="javascript:;" class=\'cluster\'>多人</a>',"</li>","<li data-key=\"food\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>食物</a>","</li>","<li data-key=\"landscape\" class='content_bottom'><a href=\"javascript:;\" class='cluster text_long'>自然风景</a>","</li>",'<li data-key="building_indoor" class="content_bottom">','<a href="javascript:;" class="cluster text_long">室内建筑</a>',"</li>",'<li data-key="building_outdoor" class="content_right content_bottom">',"<a href=\"javascript:;\" class='cluster text_long'>室外建筑</a>","</li>","<li data-key=\"plant\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>植物</a>","</li>","<li data-key=\"animal\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>动物</a>","</li>","<li data-key=\"transport\" class='content_bottom'><a href=\"javascript:;\" class='cluster text_long'>交通工具</a>","</li>","<li data-key=\"other\" class='content_bottom content_right'><a href=\"javascript:;\" class='cluster'>其他</a>","</li>","</ul>","</div>"].join("");i.prototype.init=function(){this.createDialog(),this.build()},i.prototype.createDialog=function(){this.dialog=l().ui.confirm("修改分类",c),this.dialog.$dialog.addClass("module-pic-category"),this.dialog.$dialog.width("480px"),this.dialog.show()},i.prototype.sendFiles=function(t,e){this.files=t,this.key=e,s(".cluster").removeClass("selected"),s(".module-pic-category").find("li[data-key="+o.toStr[e]+"]").children().addClass("selected")},i.prototype.request=function(t,e){var a=function(t){var e="";e=3===t?"一次操作文件不可超过200个":l().errorMsg(t),l().ui.tip({mode:"caution",msg:e||"网络错误，请稍候重试",hasClose:!1,autoClose:!0})};s.ajax({type:"GET",data:t,url:"/api/image/adjusttag",dataType:"json",success:function(t){0===t.errno?"function"==typeof e&&e(t):a(t.errno)},error:a})},i.prototype.build=function(){var t=this;s(window).bind("resize",function(){t.dialog.position("center",s("body"))}),s(".cluster").bind("click",function(t){var e=s(t.target);s(".cluster").removeClass("selected"),e.addClass("selected")}),s(".module-pic-category .dialog-close").click(function(){t.dialog.hide()});var e=s(".module-pic-category .dialog-footer .g-button");e[0].className+=" confirm",e[1].className+=" cancel",s(".confirm").click(function(e){e.stopPropagation();var a=t.files,i=a.length-1,c=[];do c.push(a[i].fs_id.toString());while(i-->0);var r=s(".selected"),n=r.parent().attr("data-key"),d=r.text();return o.toStr[t.key]!==n&&t.request({fid:s.stringify(c),tag:s.stringify([o.toNum[n].toString()])},function(){l().ui.tip({mode:"success",msg:"修改分类成功",hasClose:!1,autoClose:!0});for(var t=0;t<a.length;t++)a[t].tag=[o.toNum[n]];var e=l().message;e.callSystem("image-classify",!0),e.trigger("pic_category_sendCat",[d,o.toNum[n]]),e.trigger("user_seleced_all",!1)}),t.dialog.hide(),l().log.send({type:"timeline2_update_tag"}),!1}),s(".cancel").click(function(){return t.dialog.hide(),!1})},a.exports=i});
;define("file-widget-1:image/util/picPreviewAside/picPreviewAside.js",function(e,t,i){var n=e("base:widget/libs/jquerypacket.js"),s=e("file-widget-1:image/context.js"),o=s.getContext,a=e("base:widget/tools/service/tools.format.js"),r=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),c=(e("base:widget/storage/storage.js"),!1),l=!1,d=6,p=3,f={init:function(e){var t=this;t.elements={mod:"#picPreviewAside",rectract:'div[node-type="retract"]',box:'div[node-type="box"]',filename:'div[node-type="filename"]',datePre:'div[node-type="date-pre"]',dateAfter:'div[node-type="date-after"]',info:'div[node-type="file-info"]',twoDimension:'div[node-type="dlg-two-dimension"]',downloadText:'a[node-type="downloadText"]',directoryBox:'div[node-type="directory-box"]',sculptureTop:'div[node-type="sculpture-top"]',sculptureBox:'div[node-type="sculpture-box"]',categoryTop:'div[node-type="category-top"]',categoryBox:'div[node-type="category-box"]',directory:'a[node-type="directory"]',size:'div[node-type="size"]',capacity:'div[node-type="capacity"]',address:'a[node-type="address"]'},t.conf=e||{},t.mod=n(t.elements.mod),t.rectract=t.mod.find(t.elements.rectract),t.box=t.mod.find(t.elements.box),t.dialog=null,t.close=!1,t.resize(),l||t.setData(),t.apiVersion=s.getVersion(),c||t.bindEvent()},bindEvent:function(){var t=this,i=t.box,s=t.rectract,a=t.mod.find(".sculpture-area");c=!0;var r=function(e){"none"===e?s.addClass("retract-icon-hide"):s.removeClass("retract-icon-hide")},l=function(e,n){n||(n={}),"block"===e?(t.mod.animate({left:278},10,function(){o().message.trigger("picPreviewAside_toggle",!1)}),i.animate({opacity:"hide"},10,function(){r("none")})):(t.mod.animate({left:0},10,function(){o().message.trigger("picPreviewAside_toggle",!0)}),i.animate({opacity:"show"},10,function(){r("block")}))};s.click(function(){l(i.css("display")),o().log.send({type:"picpreview_close_detail_click"})}),o().message.listen("resize_showAside",function(){t.resize()}),o().message.listen("resolve_aside_visible",function(){"none"===i.css("display")?(i.css("display","block"),l("none"),o().log.send({type:"picpreview_open_detail_click"})):(i.css("display","none"),l("block"),o().log.send({type:"picpreview_close_detail_click"}))}),o().message.listen("clean_detail_humanCover",function(e){for(var t=0;t<a.length;t++){var i=n(a[t]).find(".sculpture-img");n(i).css("display",status),e.isClean?n(i).css("display","none").attr("src",""):n(i).css("display","inline-block")}}),t.mod.find("a[node-type='editor-icon']").on("click",function(){var i=e("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js"),n=t.mod.find('span[node-type="type-name"]').attr("data-key"),s=t.mod.find('span[node-type="type-name"]').attr("data-index"),a=[];t.dialog=new i,o().message.listen("pic_category_sendCat",function(e){t.mod.find('span[node-type="type-name"]').html(e[0]).attr("data-key",e[1]);var i=t.conf.list,n=t.conf.index,s=t.conf.list[n],a=i.length;o().message.trigger("delete_picPreview",{callback:function(e){return 1==a?(o().message.trigger("close_picPreview_dialog"),!0):void o().message.trigger("delete_picture",{list:e,index:n})},index:n,file:s})});for(var r in t.conf.list)s==t.conf.list[r].fs_id&&(a.push(t.conf.list[r]),t.dialog.sendFiles(a,n),a=[])}),n(t.elements.directory).on("click",function(){o().log.send({type:"picpreview_open_directory_click"})}),n(t.elements.categoryLeftInfo).on("click",function(){o().log.send({type:"picpreview_open_category_click"})}),n(t.elements.categoryRightInfo).on("click",function(){o().log.send({type:"picpreview_open_category_click"})})},setData:function(){var e=this,t=e.mod.find(e.elements.info),i=(t.find(e.elements.humanSculpture),t.find(e.elements.sculptureTop)),s=t.find(e.elements.sculptureBox),c=t.find(e.elements.categoryTop),f=t.find(e.elements.categoryBox),h=f.children(),u=t.find(e.elements.dateAfter),m=t.find(e.elements.datePre),g=t.find(e.elements.size),y=t.find(e.elements.capacity),v=t.find(e.elements.address),k=t.find(e.elements.filename),_=t.find(e.elements.directory),b=o().tools.shareDirManager;l=!0,o().message.listen("img_showAside",function(t){var l,x,w,P,C,z,A,j=t.file,O=function(e){for(var t=[[],[]],i=0;i<e.length;i++)t[0].push("/disk/timeline#/faceList/"+e[i].person_id),t[1].push(e[i].cover_photo);return t},T=function(e){var t=new Date(1e3*e),i=["周日","周一","周二","周三","周四","周五","周六","周日"],n=[t.getFullYear(),t.getMonth()+1,t.getDate(),i[t.getDay()],t.getHours(),t.getMinutes()],s="",o=[],a=function(e){return e>=0&&9>=e&&(e="0"+e),e};return s=n[4]<12?"上午":"下午",n[4]=a(n[4]),n[5]=a(n[5]),o.push(n[0]+"年"+n[1]+"月"+n[2]+"日"),o.push(n[3]+"，"+s+n[4]+":"+n[5]),o},I=function(e){for(var t=e.split(","),i=[],n=0;n<t.length;n++)i.push(t[n].match(/\d+/g));return i.join(" x ")},D=function(e){var t,i,n,s=e.split("/");return""===s[s.length-2]?(t=s.pop(),i="我的网盘",n="/disk/home"):(t=s.pop(),i=s.pop(),n="/disk/home#/all?path="+encodeURIComponent(e.substr(0,e.lastIndexOf("/")+1))),{filename:t,dirname:i,href:n}},R=function(e){var t,i,n,s=b.getFakepathInfo(e);if(s&&s.subPath){var o=s.subPath.split("/");o.length>1?(t=o.pop(),i=o.pop(),n="/disk/home#/sharedir?path="+encodeURIComponent("/"+s.fakeRootPath+"/"+s.subPath.substr(0,s.subPath.lastIndexOf("/")))):(t=o.pop(),b.getNameByFakepath(e,function(e){i=e}),n="/disk/home#/sharedir?path="+encodeURIComponent("/"+s.fakeRootPath))}return{filename:t,dirname:i,href:n}},B=function(e){for(var t={affair:[],position:[]},i=0;i<e.length;i++){var n=e[i].tag_type;1===n?t.affair.push(e[i].tag_id):2===n&&t.position.push(e[i].tag_id)}return t},F=function(t){if("[object Array]"===Object.prototype.toString.call(t)){var i,n=[257,258,259,260,512,768,1024,1281,1282,1536,1792,2304,2048],s=[1,2,17,18,19,20,21,22,23,100,200,300,440,501,502,503,504,505,506,507,508,509,510,511,512,513,515,700,801,901,902,903,1e3,1001,1002,2e3];i=e.apiVersion?s:n;var o=function(e,t){for(var i=[],n=0;n<t.length;n++)-1!==e.indexOf(t[n])&&i.push(t[n]);return i},a=function(t){if(e.apiVersion){for(var i,n,s=[17,18,801],o=[1,2,19,20,21,22,23,100,200,300,440,501,502,503,505,506,508,509,510,511,512,513,515,700,902,903,1e3,1001,1002,2e3],a=[901],r=[504,507],c=[[],[],[],[]],l=[[],[],[],[]],d=[],p=0;p<t.length;p++)-1!==s.indexOf(t[p])?(c[0].push(t[p]),l[0].push(46)):-1!==o.indexOf(t[p])?(c[1].push(t[p]),l[1].push(46)):-1!==a.indexOf(t[p])?(c[2].push(t[p]),l[2].push(66)):-1!==r.indexOf(t[p])&&(c[3].push(t[p]),l[3].push(76));return i=c[1].concat(c[0]).concat(c[2]).concat(c[3]),n=l[1].concat(l[0]).concat(l[2]).concat(l[3]),i&&0!==i.length&&d.push(i),n&&0!==n.length&&d.push(n),d}var f=t.indexOf(1536),h=[];return 2===t.length?-1!==f?(h.push(t.splice(f,1).push(1536)),h.push([46,66]),h):(h.push(t),h.push([46,46]),h):1===t.length?-1!==f?(h.push(t),h.push([66]),h):(h.push(t),h.push([46]),h):h},r=o(i,t);return a(r)}return[]},S=function(t){var i,n={257:"单人",258:"双人",259:"三人",260:"多人",512:"动物",768:"植物",1792:"食物",1024:"风景",1281:"室内",1282:"室外",1536:"交通工具",2304:"截屏",2048:"其他"},s={1:"街景",2:"装修",17:"车",18:"船",19:"婚礼",20:"演出",21:"聚会",22:"截图",23:"卡通",100:"食物",200:"动物",300:"运动",440:"家居",501:"海洋",502:"水下",503:"沙滩",504:"河流与湖泊",505:"雪地",506:"天空",507:"日出与日落",508:"草原",509:"山峰",510:"星空",511:"夜景",512:"沙漠",513:"山谷",515:"瀑布",700:"票据",801:"花",901:"建筑外景",902:"教堂",903:"寺庙",1e3:"人物",1001:"宝宝",1002:"自拍",2e3:"其他"};i=e.apiVersion?s:n;for(var o=[],a=[],r=[],c=0;c<t.length;c++)t[c]in i&&(o.push(i[t[c]]),a.push("/disk/timeline#/classifyList/1/"+t[c]));return r.push(o),r.push(a),r};if(e.apiVersion?j.tags&&(l=B(j.tags),x=l.affair,w=l.position,w&&(P="/disk/timeline#/classifyList/2/"+w),C=F(x)):j.tag&&(C=F(j.tag)),C&&2===C.length&&(z=S(C[0])),z&&2===z.length&&(A=C[1]),j.date_taken&&(j.dateTaken=j.date_taken),j.dateTaken)var V=T(j.dateTaken);var L=j.resolution?I(j.resolution):"",M=j.size?a.toFriendlyFileSize(j.size):"";if(j.path)var U="sharedir"===o().router.currentRouteName?R(j.path):D(j.path);if(j instanceof Object&&(g.show(),y.show(),j.resolution&&j.size?(g.html(L),y.html(M)):j.resolution&&!j.size?(g.html(L),y.hide()):!j.resolution&&j.size?(y.html(M),g.hide()):(g.html("未知"),y.hide()),j.path?k.html(U.filename).attr("title",U.filename):k.html("未知"),!t.hideMeta)){if(j.human_face&&j.human_face.length>0){o().message.trigger("clean_detail_humanCover",{isClean:!1});var E=O(j.human_face),N=s.children(),q=[],H=[];"none"===i.css("display")&&i.css("display","block"),"none"===s.css("display")&&s.css("display","block");for(var Y=0;Y<N.length;Y++)q.push(n(N[Y]).children()[0]);for(var G=0;G<q.length;G++)H.push(n(q[G]).children()[0]);for(var J=0;J<E[0].length;J++)n(q[J]).attr("href",E[0][J]),n(H[J]).attr("src",r.getProcessedSrc(E[1][J])),n(N[J]).css("display","inline-block");for(;d>J;)n(N[J]).css("display","none"),J++}else i.css("display","none"),s.css("display","none");if(z&&0!==z.length&&A&&0!==A.length){var K=[];"none"===c.css("display")&&c.css("display","block"),"none"===f.css("display")&&f.css("display","block");for(var Q=0;Q<h.length;Q++)K.push(n(h[Q]).children()[0]);for(var W=0;W<z[0].length;W++)n(h[W]).css("display","inline-block").css("width",A[W]),n(K[W]).html(z[0][W]).attr("href",z[1][W]);for(;p>W;)n(h[W]).css("display","none"),W++}else c.css("display","none"),f.css("display","none");if(j.dateTaken?("none"===u.css("display")&&u.css("display","block"),m.html(V[0]),u.html(V[1])):(m.html("神秘时间"),u.css("display","none")),j.country&&"other"!==j.country&&j.province&&"other"!==j.province&&j.city&&"other"!==j.city){var X="";j.province===j.city?(X=j.district&&"other"!==j.district?j.country+" "+j.province+" "+j.district:j.country+" "+j.province,v.html(X).attr("title",X)):(X=j.country+" "+j.province+" "+j.city,v.html(X).attr("title",X)),P?v.attr("href",P).css("text-decoration","underline"):v.removeAttr("href").css("text-decoration","none")}else v.html("未知").removeAttr("href").css("text-decoration","none");j.path?(_.html(U.dirname).attr("title",U.dirname),_.attr("href",U.href)):_.html("未知").removeAttr("href")}})},resize:function(){var e=this;n(document).width()<1024&&(e.close?(e.mod.css("left","0px"),e.rectract.removeClass("retract-icon-hide"),e.box.css("display","block"),e.close=!1):(e.mod.css("left","253px"),e.rectract.addClass("retract-icon-hide"),e.box.css("display","none")))}};i.exports=f});
;define("file-widget-1:image/util/thumbnailPic/thumbnailPicList.tpl.js",function(i,e,t){var s=[];s.push("<%for (var i=0; i<list.length; i++){%>"),s.push("<% var item = list[i]%>"),s.push('<li node-type="thumb-item" class="thumb-item <%if(item.index==index){%>current<%}%>">'),s.push('<img node-type="slider-item" class="slider-item" data-index=<%=item.index%> src="<%=item.thumbUrl%>"></img>'),s.push("</li>"),s.push("<%}%>"),t.exports=s.join("")});
;define("file-widget-1:image/util/thumbnailPic/thumbnailPic.js",function(e){var t=e("base:widget/libs/jquerypacket.js"),i=e("file-widget-1:image/util/picPreview/picPreview.js"),n=e("file-widget-1:image/util/thumbnailPic/thumbnailPicList.tpl.js"),o=e("file-widget-1:image/context.js"),s=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),l=e("base:widget/libs/underscore.js"),d=e("base:widget/storage/storage.js"),r=function(){var e={},r={},a=function(){r.addEvent();var e=o.getContext().tools.baseService.client();6===e.browser.ie&&(r.$q.$showThumb.html('<em class="show-icon" node-type="show-icon"></em><span node-type="show-title">展开缩略图</span>'),r.q.showIcon='em[node-type="show-icon"]',r.$q.$showIcon=t(r.q.showIcon)),d.getItem("picDetailTip")&&r.$q.$detailTip.remove()};r.delayTime=200,r.delay=!1,r.firstResize=!0,r.deleteProcess=!1,r.thumbNum=11,r.flag=Math.floor((r.thumbNum-1)/2),r.filesList=[],r.index=0,r.arrow=0,r.start=0,r.end=0,r.thumbSize={width:256,height:256},r.defaultSize={width:window.screen.width,height:window.screen.height},r.thumbDefaultPicUrl="/yun-static/common/images/default_128.gif",r.apiVersion=o.getVersion(),r.q={mod:"div.module-thumbnailPic",thumbList:'ol[node-type="thumb-list"]',thumbItem:'li[node-type="thumb-item"]',sliderItem:'img[node-type="slider-item"]',operateArea:'div[node-type="operate-area"]',wrap:'div[node-type="thumb-wrap"]',showThumb:'div[node-type="show-thumb"]',showIcon:'em[node-type="show-icon"]',showTitle:'span[node-type="show-title"]',print_pic:"div[node-type='print-pic']",controlLeft:'em[node-type="control-left"]',controlRight:'em[node-type="control-right"]',controlShare:'em[node-type="control-share"]',controlDownload:'em[node-type="control-download"]',controlEdit:'em[node-type="control-edit"]',controlDelete:'em[node-type="control-delete"]',showThumbTitle:'em[node-type="show-thumb-title"]',showThumbIcon:'em[node-type="show-thumb-icon"]',detailTip:'div[node-type="img-detail-tip"]'},r.$q={$mod:t(r.q.mod),$thumbList:t(r.q.mod).find(r.q.thumbList),$sliderItem:t(r.q.mod).find(r.q.sliderItem),$thumbWrap:t(r.q.wrap),$showThumb:t(r.q.showThumb),$showIcon:t(r.q.showIcon),$showTitle:t(r.q.showTitle),$printPic:t(r.q.print_pic),$showThumbTitle:t(r.q.showThumbTitle),$showThumbIcon:t(r.q.showThumbIcon),$detailTip:t(r.q.detailTip)},r.resolvModSize=function(){r.$q.$thumbWrap.width(r.filesList.length>=r.thumbNum?94*r.thumbNum-4:94*r.filesList.length-4)},r.build=function(e){r.index=parseInt(e.index,10);for(var t=0;t<e.list.length;t++){var i=e.list[t];i.index=t,i.thumbUrl=s.getThumbnailByFile(i,r.thumbSize)}r.filesList=e.list,r.resolvModSize(),r.buildHtml()},r.buildHtml=function(){function e(){o.getContext().message.trigger("changeToolbar",r.index)}var i=o.getContext().tools.baseService.tmpl,s=i(n),l=(t(r.q.mod).find(r.q.sliderItem),r.index),d=r.thumbNum,a=r.flag,h=null;r.showPicture(),h=s(r.filesList.length>=r.thumbNum?l>=0&&a>=l?{list:r.filesList.slice(0,d),index:l}:r.filesList.length-a-1<=l&&l<=r.filesList.length-1?{list:r.filesList.slice(r.filesList.length-d),index:l}:{list:r.filesList.slice(l-a,l-a+d),index:l}:{list:r.filesList.slice(0,r.filesList.length),index:l}),r.$q.$thumbList.html(h),r.preLoadImg(e),r.changeAside(),r.addSign(),r.arrow=l},r.deletePic=function(e){r.deleteProcess=!0,e.index==e.list.length&&(e.index-=1),r.build({index:e.index,list:e.list})},r.changePic=function(e){var t=r.arrow,i=r.flag,s=o.getContext().tools.baseService.tmpl,l=s(n),d=function(e){r.showPicture(),r.preLoadImg(),r.changeAside(),r.addSign(),r.arrow=e,o.getContext().message.trigger("changeToolbar",r.index),o.getContext().message.trigger("changePic",r.filesList[e])};if(e>0)if(t+=1,r.filesList.length>=r.thumbNum)if(t>=i+1&&t<=r.filesList.length-i-1)r.index=r.index+1,r.$q.$thumbList.get(0).removeChild(r.$q.$thumbList.children().get(0)),r.$q.$thumbList.append(l({list:r.filesList.slice(t+r.thumbNum-1-i,t+r.thumbNum-i),index:r.index})),d(t);else{if(!(t>=1&&i>=t||r.filesList.length-i-1<=t&&t<=r.filesList.length-1))return r.arrow=r.filesList.length-1,void r.loadNextDay();r.index=r.index+1,d(t)}else{if(!(t>=1&&t<=r.filesList.length-1))return r.arrow=r.filesList.length-1,void r.loadNextDay();r.index=r.index+1,d(t)}else if(t-=1,r.filesList.length>=r.thumbNum)if(t>=i&&t<=r.filesList.length-i-2)r.index=r.index-1,r.$q.$thumbList.get(0).removeChild(r.$q.$thumbList.children().get(r.thumbNum-1)),r.$q.$thumbList.prepend(l({list:r.filesList.slice(t-i,t-i+1),index:r.index})),d(t);else{if(!(t>=0&&i>t||r.filesList.length-i-2<t&&t<=r.filesList.length-2))return r.arrow=0,void r.loadPreDay();r.index=r.index-1,d(t)}else{if(!(t>=0&&t<=r.filesList.length-2))return r.arrow=0,void r.loadPreDay();r.index=r.index-1,d(t)}},r.loadNextDay=function(){o.getContext().ui.tip({mode:"caution",msg:"已经是最后一张图片啦",hasClose:!1,autoClose:!0})},r.loadPreDay=function(){o.getContext().ui.tip({mode:"caution",msg:"已经是第一张图片啦",hasClose:!1,autoClose:!0})},r.resetThumbList=function(){r.$q.$thumbList.html("")},r.changeAside=function(){var e=r.filesList[r.index],t=o.getContext().pageInfo.currentPage;t=/^share-/.test(t)?!0:!1,t?r.triggerEvent("img_showAside",{file:e,hideMeta:t}):i.getFileData(e,function(e){r.triggerEvent("img_showAside",{file:e,hideMeta:t})})},r.replaceErrorThumb=function(e){for(var i=t(r.q.mod).find(r.q.thumbItem),n=i.children(),o=n.length,s=0,l=null;o>s;s++)if(l=n.eq(s),l.data("index")==e){l.css("backgroundImage","url("+r.filesList[e].thumbUrl+")");break}},r.preLoadImg=function(e){var t=r.index,i=function(e,t){t&&(e.width=this.width,e.height=this.height)};if(e){var n=function(t,i){i&&(t.width=this.width,t.height=this.height),e&&e()};r.loadImg(r.filesList[t],r.defaultSize,n,1)}for(var o=-1;5>o;o++){var s=t+o;if(0!=o&&s>=0&&s<r.filesList.length)r.loadImg(r.filesList[s],r.defaultSize,i,1);else if(0!=o&&0!=t)break}},r.loadImg=function(e,t,i,n){var l=(new Date).getTime()+"_preloadImg";window[l]=new Image;var d=window[l];d.src=s.getThumbnailByFile(e,t,n),d.startTime=+new Date,d.picType="thumbnail",t.width>256&&t.height>256&&(d.picType="bigPic");var r=function(e){var t=50;return"number"==typeof e?Math.ceil(e/t)*t:""};return d.complete?(window[l]=null,void i.call(d,e,!0)):(d.onload=function(){i.call(d,e,!0);var t=+new Date-d.startTime;o.getContext().log.send({type:"imgLoading_"+d.picType+"_"+r(t)}),d.onload=null,window[l]=null},void(d.onerror=function(){i.call(d,e,!1);var t=+new Date-d.startTime;o.getContext().log.send({type:"imgLoading_"+d.picType+"_"+r(t)}),d.onload=null,window[l]=null}))},r.addSign=function(){var e=t(r.q.mod).find(r.q.thumbItem),i=e.children(),n=i.length,o=0,s=null;for(e.removeClass("current");n>o;o++)if(s=i.eq(o),s.data("index")==r.index){s.parent().addClass("current");break}},r.showPicture=function(){r.triggerEvent("img_showPic",{index:r.index,file:r.filesList[r.index],len:r.filesList.length})},r.addEvent=function(){var e=r.$q.$mod,i=o.getContext().tools.baseService.client();r.$q.$mod.delegate(r.q.sliderItem,"click",function(){t(this).parent().hasClass("current")||(r.index=t(this).data("index"),o.getContext().message.trigger("changePic",r.filesList[r.index]),t(r.q.mod).find(r.q.thumbItem).removeClass("current"),r.resetThumbList(),r.buildHtml())}),e.find(r.q.operateArea).bind("click",l.throttle(function(e){"undefined"==typeof t(e.target).attr("node-type")?o.getContext().message.trigger("operate_button",t(e.target).parent().attr("node-type")):o.getContext().message.trigger("operate_button",t(e.target).attr("node-type"))},1e3)),r.$q.$showThumb.bind("click",function(){r.$q.$thumbWrap.is(":animated")||r.$q.$thumbWrap.slideToggle(function(){if(6===i.browser.ie)r.$q.$showIcon.toggleClass("show"),r.$q.$showTitle.html(r.$q.$showIcon.hasClass("show")?"收起缩略图":"展开缩略图");else{{t("div.module-showPic").css("height")}"none"===r.$q.$thumbWrap.css("display")?(r.$q.$showThumbTitle.html("展开缩略图"),r.$q.$showThumbIcon.removeClass("icon-picpre-pulldown"),r.$q.$showThumbIcon.addClass("icon-picpre-pullup"),o.getContext().message.trigger("thumbnailPic_up_down",!1)):(r.$q.$showThumbTitle.html("收起缩略图"),r.$q.$showThumbIcon.removeClass("icon-picpre-pullup"),r.$q.$showThumbIcon.addClass("icon-picpre-pulldown"),o.getContext().message.trigger("thumbnailPic_up_down",!0)),r.$q.$showThumb.toggleClass("show")}})}),r.initListenEvent()},r.triggerEvent=function(e,t){o.getContext().message.trigger(e,t)},r.listenEvent=function(e,t){o.getContext().message.listen(e,t)},r.initListenEvent=function(){r.listenEvent("resize_picture",function(e){return r.delay?!1:(r.triggerEvent("resize_showPic",e),r.triggerEvent("resize_showAside",e),r.firstResize?r.firstResize=!1:(r.delay=!0,setTimeout(function(){r.delay=!1},r.delayTime)),void 0)}),r.listenEvent("img_thumbnailPic",function(e){r.build(e)}),r.listenEvent("change_picture",function(e){r.changePic(e)}),r.listenEvent("delete_picture",function(e){r.deletePic(e)}),r.listenEvent("close_picPreview_success",function(){r.firstResize=!0,r.resetThumbList()}),r.listenEvent("resolve_pic_controls",function(e){r.resolveControls(e)})};var h="show",u="hide";r.resolveControls=function(e){var i=o.getContext().pageInfo.currentPage;i=/^share-/.test(i)?!0:!1,i&&(e=t.extend({print:"hide",share:"hide",edit:"hide",del:"hide"},e,{})),e=e||{},r.$q.$mod.find(r.q.print_pic)[e.print?u:h](),r.$q.$mod.find(r.q.controlShare)[e.share?u:h](),r.$q.$mod.find(r.q.controlDownload)[e.download?u:h](),r.$q.$mod.find(r.q.controlEdit)[e.edit?u:h](),r.$q.$mod.find(r.q.controlDelete)[e.del?u:h](),e.hideAside&&r.triggerEvent("resolve_aside_visible",null)},a.apply(e,arguments)};new r});
;define("file-widget-1:image/util/picPreview/picPreview.js",function(e,i,t){function o(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(i){return!1}}function n(){return"livePhotoConf_"+l().locals.get("uk")}var a=e("base:widget/libs/jquerypacket.js"),s=e("base:widget/storage/storage.js"),l=e("file-widget-1:image/context.js").getContext,r=e("file-widget-1:image/util/picPreview/picPreview.tpl.js"),d=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),c=e("file-widget-1:image/util/showPic/showPic.tpl.js"),p=e("file-widget-1:image/util/picPreviewAside/picPreviewAside.tpl.js"),h=e("file-widget-1:image/util/thumbnailPic/thumbnailPic.tpl.js"),g=e("file-widget-1:image/util/showPic/log.js"),u=window.disk,m=function(){this._mCloseId=u.obtainId(),this._mWinHeight=a(window).height(),this._mKeyguardListener=null,this._mMotionSensor=l().tools.motionSensor.hasMotionCampatibility(),this.$mod=null,this.$modBd=null,this.$modCanvas=null,this.dialog=null,this._mResizeTimer=null,this._mScrollTimer=null,this._mMouseTimer=null,this._mKeyboardTimer=null,this.asideDisplayFlag=!1,this.thumbnailPicFlag=!1,this._mCoor=[],this.keepCanvas=!1,this.H5VideoSupport=d.checkH5VideoSupport(),this.checkBrowser=d.checkSpecialBrowser(),this._prebuild()};m.RESIZE_DELAY_TIME=200,m.SCROLL_DELAY_TIME=200,m.MOUSE_KEYBOARD_DELAY_TIME=200,m.MIN_WIDTH=1024,m.q={mod:"div.module-picPreview",modBd:'div[node-type="dlg-bd"]',modAside:"#picPreviewAside",modCanvas:"div.module-canvas",categoryItem:'div[node-type="category-item"]',livephotoControl:'div[node-type="dlg-livephoto-control"]',livephotoIcon:'div[node-type="livp-icon"]',livephotoTip:'div[node-type="livp-play-tip"]'},m.singleton=null,m.obtain=function(){return m.singleton?m.singleton:m.singleton=new m},m.buildDialog=function(e){var i=null,t=m.singleton;i=m.obtain(),i.initDialog(e),t||i._init(e),i.triggerEvent("resolve_pic_controls",e.controls||{}),i.triggerEvent("replcae_download_function",{downloadFunc:e.downloadFunc}),i.dialog.show(),i.dialog.$dialog[0].style.left=0,i.onVisibilityChange(),i.$modCanvas=a(this.q.modCanvas)},m.prototype.resizeCanvas=function(){this.$modCanvas.css({opacity:1,filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=1)",background:"#1f1f1f"})},m.getFileData=function(e,i){e.human_face&&e.tags&&e.tag&&e.dateTaken&&e.date_taken&&e.resolution&&e.size&&e.country&&e.province&&e.city&&e.district&&e.path||e.hasRequestFileMetas?i(e):a.ajax({url:"/aipic/image/filemetas",type:"GET",data:"fids="+a.stringify([e.fs_id]),dataType:"json",success:function(t){if(t&&0===t.errno&&t.list)for(var o=t.list[0],n=[{name:"human_face"},{name:"tags"},{name:"tag"},{name:"dateTaken"},{name:"date_taken"},{name:"resolution"},{name:"country",noValue:"other"},{name:"province",noValue:"other"},{name:"city",noValue:"other"},{name:"district",noValue:"other"},{name:"path"}],a=function(i,t,n,a){var s=t?!e[i]&&o&&o[i]&&"other"!==o[i]:!e[i]&&o&&o[i];s&&(a[i]=n[i])},s=0;s<n.length;s++){var l=n[s];a(l.name,l.noValue,o,e)}else u.DEBUG&&console.log("AJAX /aipic/image/filemetas ERROR !");i(e)},error:function(){u.DEBUG&&console.log("AJAX /aipic/image/filemetas ERROR !")}}),e.hasRequestFileMetas=!0},m.prototype.setSize=function(e,i){var t=this;t.dialog.$dialog.width(e),t.dialog.$dialog.height(i)},m.prototype.setLocation=function(e,i){var t=this;i=Math.max(0,i),t.dialog.$dialog[0].style.left=e+"px",t.dialog.$dialog[0].style.top=i+"px",t._mCoor[0]=e,t._mCoor[1]=i},m.prototype.initDialog=function(e){this.recordData(e),this.build()},m.prototype.recordData=function(e){this.conf=e},m.prototype._prebuild=function(){var e=this,i=l().tools.baseService.tmpl,t=a(window).width()>m.MIN_WIDTH?a(window).width():m.MIN_WIDTH;e.dialog||(e.dialog=l().ui.window({title:"",titleIcon:"",theme:"",max:!1,back:!1,min:!1,close:!0,width:t,height:a(window).height(),draggable:!1,lock:!0,noHeader:!0,noFooter:!0})),e.dialog.$dialog.addClass("imgDialog");var o=document.createElement("div"),n=i(r);o.className="img-dialog module-picPreview",o.id="imgs-dialog",document.body.appendChild(o),o.innerHTML=n({closeId:this._mCloseId});var s=document.createElement("div"),d=i(c),g=i(h);s.className="dlg-bd",s.setAttribute("node-type","dlg-bd"),s.innerHTML=d({}),o.appendChild(s),o.innerHTML+=g({});var u=document.createElement("div"),v=i(p());u.className="dlg-aside",u.setAttribute("node-type","dlg-aside"),u.innerHTML=v({}),o.appendChild(u),window.ActiveXObject&&e.dialog.$dialog.css("background","#000"),e.dialog.$dialog.find(".dialog-body").html(o),l().message.callSystem("addIcon",o),e.$mod=e.dialog},m.prototype.build=function(){this._initDom(),this.requireModuleJs(),this.resolvBdSize(),this.triggerEvent("img_thumbnailPic",{index:this.conf.index,list:this.conf.list})},m.prototype.requireModuleJs=function(){window.showPic=e("file-widget-1:image/util/showPic/showPic.js"),m.picPreviewAside=e("file-widget-1:image/util/picPreviewAside/picPreviewAside.js"),e("file-widget-1:image/util/thumbnailPic/thumbnailPic.js")},m.prototype._initDom=function(){this.$mod=a(this.constructor.q.mod),this.$modBd=this.$mod.find(this.constructor.q.modBd),this.$modAside=this.$mod.find(this.constructor.q.modAside)},m.prototype.resolvBdSize=function(){var e=this.asideDisplayFlag,i=this.thumbnailPicFlag,t=Math.max(a(window).width(),m.MIN_WIDTH),o=a(window).height();this.$modBd.width(t-(e?278:0)),this.$modBd.height(o-(i?122:52)),this.triggerEvent("resize_picture",{imgDialogBd:this.$modBd})},m.prototype.dispatchDialogSize=function(){var e=this;if(e.dialog.isVisible()){var i=Math.max(a(window).width(),m.MIN_WIDTH),t=a(window).height();e.setSize(i,t),e.dispatchOnScroll()}},m.prototype.dispatchOnSize=function(){var e=this;e._mWinHeight=a(window).height(),e._mWinWidth=a(window).width()>m.MIN_WIDTH?a(window).width():m.MIN_WIDTH,e.dialog.isVisible()&&(e.setSize(e._mWinWidth,e._mWinHeight),e.resolvBdSize())},m.prototype.dispatchOnScroll=function(){var e=this;if(e.dialog.isVisible()){var i=Math.max(a("body").scrollLeft(),a("html").scrollLeft()),t=Math.max(a(window).scrollTop(),a("html").scrollTop());e.setLocation(i,t)}},m.prototype.dispatchOnMouseEvent=function(e){var i=this,t=e>0?1:-1;i.changeImgAnimation(t)},m.prototype.dispatchOnKeyboardEvent=function(e){var i=this;i.changeImgAnimation(e)},m.prototype.saveGuideShow=function(e,i){e&&(i||e.hide())},m.prototype._init=function(e){var i,t=this,o=e.list[e.index];try{i=a.parseJSON(s.getItem(n()))||{}}catch(r){i={}}/\.livp$/.test(o.path)&&t.H5VideoSupport?(t.updateLivpControlButton(0===+i.autoPlay||/ie|edge/.test(t.checkBrowser)?"show-not-loading":"show-loading"),1===+i.hideButtonTip?t.updateLivpControlButton("hide-play-tip"):/ie|edge/.test(t.checkBrowser)&&t.updateLivpControlButton("show-play-tip")):/\.livp$/.test(o.path)&&!t.H5VideoSupport?(t.updateLivpControlButton("not-support"),1!==+i.hideButtonTip&&t.updateLivpControlButton("not-support-tip")):(t.updateLivpControlButton("hide"),t.updateLivpControlButton("hide-play-tip")),e&&"unzip"==e.from&&(this.keepCanvas="keepCanvas"),a(window).bind("resize",function(){t.dialog.isVisible()&&(null!=t._mResizeTimer&&clearTimeout(t._mResizeTimer),t._mResizeTimer=setTimeout(function(){t._mResizeTimer=null,t.dispatchOnSize(),t.dispatchDialogSize()},t.constructor.RESIZE_DELAY_TIME))}),a(window).bind("scroll",function(){t.dialog.isVisible()&&(null!=t._mScrollTimer&&clearTimeout(t._mScrollTimer),t._mScrollTimer=setTimeout(function(){t._mScrollTimer=null,t.dispatchOnScroll()},t.constructor.SCROLL_DELAY_TIME))}),a('[node-type="save-to-mine-close"]').bind("click",function(){g.sendlog("saveImgGuideCloseClk",g.getCommonLogParam({})),t.saveGuideShow(a('[node-type="save-to-mine-hover"]'),!1)}),a("#"+t._mCloseId).bind("click",function(){t.clearReader(t.keepCanvas)}),a(m.q.livephotoIcon).on("click",function(){try{i=a.parseJSON(s.getItem(n()))||{}}catch(e){i={}}var o="",r=a(this).attr("class"),d="",c="",p="";/start-loading/.test(r)?(o="stopLoading",d="stop-loading",c="开始播放",p="picpreview_livephoto_click_play_or_pause",i.autoPlay=0):/stop-loading/.test(r)||"livp-icon"===r?(o="startLoading",d="start-loading",p="picpreview_livephoto_click_play_or_pause",i.autoPlay=1):/livp-pause|loaded-and-not-play/.test(r)?(o="livpPlay",d=(/ie|edge/.test(t.checkBrowser)?"ie-":"")+"livp-play-from-pause",c="暂停播放",p="picpreview_livephoto_click_play_or_pause",i.autoPlay=1):/livp-play-from-pause|livp-play-from-loading/.test(r)?(o="livpPause",d=(/ie|edge/.test(t.checkBrowser)?"ie-":"")+"livp-pause",c="开始播放",p="picpreview_livephoto_click_play_or_pause",i.autoPlay=0):/livp-error/.test(r)?(d="livp-error",c="实况照片加载失败"):/livp-not-support/.test(r)&&(d="livp-not-support",c="浏览器版本过低，不支持播放实况照片"),a(this).removeClass().addClass("livp-icon "+d).attr("title",c),/livp-not-support/.test(r)?t.updateLivpControlButton("not-support-tip"):"block"===a(m.q.livephotoTip).css("display")&&(i.hideButtonTip=1,t.updateLivpControlButton("hide-play-tip")),s.setItem(n(),a.stringify(i)),o&&t.triggerEvent("click_livp_control",o),p&&l().log.send({type:"picpreview_livephoto_click_play_or_pause"})});var d=l().tools.keyGuard;t._mKeyguardListener||(t._mKeyguardListener={onMount:function(){},onConnectivity:function(){},onKeyAction:function(e){if(t.dialog&&t.dialog.isVisible()===!0)switch(e){case d.EVENT_PAGE_UP:t.delayChangeImg(-1);break;case d.EVENT_PAGE_DOWN:t.delayChangeImg(1);break;case d.EVENT_ARROW_UP:t.delayChangeImg(-1);break;case d.EVENT_ARROW_DOWN:t.delayChangeImg(1);break;case d.EVENT_ARROW_LEFT:t.delayChangeImg(-1);break;case d.EVENT_ARROW_RIGHT:t.delayChangeImg(1);break;case d.EVENT_ESCAPE:t.clearReader(t.keepCanvas)}return!0},onKeyEvent:function(){}}),l().tools.baseService.mouseWheel(t.$modBd.get(0),function(e){null!=t._mMouseTimer&&clearTimeout(t._mMouseTimer),t._mMouseTimer=setTimeout(function(){t._mMouseTimer=null,t.dispatchOnMouseEvent(e)},t.constructor.MOUSE_KEYBOARD_DELAY_TIME)},"bool"),t.listenEvent()},m.prototype.listenEvent=function(){var e=this,i=l();i.message.listen("picPreviewAside_toggle",function(i){e.asideDisplayFlag=i,e.picAsideShow=i,e.resolvBdSize()}),i.message.listen("close_picPreview_dialog",function(){e.clearReader(e.keepCanvas)}),i.message.listen("thumbnailPic_toggle",function(i){e.thumbnailPicFlag=i,e.resolvBdSize()}),i.message.listen("changeToolbar",function(t){var n=e.conf.list[t],a=n.oper_id===i.locals.get("uk"),s=e.dialog.$dialog,l=s.find('[node-type="img-control"]'),r=s.find('[node-type="face-search"]'),d=s.find('[node-type="print-pic"]'),c=s.find('[node-type="print-pic-new"]'),p=s.find('[node-type="control-share"]'),h=s.find('[node-type="save-to-mine"]'),g=s.find('[node-type="save-to-mine-hover"]'),u=s.find('[node-type="control-edit"]'),m=s.find('[node-type="control-delete"]'),v=i.router.currentRouteName,w="doc-share"===i.pageInfo.currentSubProduct,_="share"===i.pageInfo.currentProduct;if("sharedir"===v||_?(l.addClass("img-control-noleft"),r.hide(),d.hide(),c.hide(),p.hide(),h.show(),e.saveGuideShow(g,!0),u.hide(),m.toggle(a)):(l.removeClass("img-control-noleft"),r.show(),d.show(),c.show(),p.show(),h.hide(),u.show(),m.show()),w){p.remove(),m.remove(),u.remove();var f=i.pageInfo.isDownloadPermission;!f&&s.find('[node-type="control-download"]').remove()}if(n.resolution||n.height>0&&n.width>0){var y=n.width||n.resolution.match(/width\:(\d+)/)[1],b=n.height||n.resolution.match(/height\:(\d+)/)[1],C=n.size,T=o(),E=location.pathname.match(/\/disk\/(home|timeline)/);2.5>y/b?d.hide():n.server_filename.match(/\.(png|jpg|jpeg|heic)$/i)&&T&&E?C>=20971520?d.hide():E&&(c.hide(),i.log.send({type:"picpreview_all_view_entry_show",imgName:n.server_filename,imgWidth:n.width||n.resolution.match(/width\:(\d+)/)[1],imgHeight:n.height||n.resolution.match(/height\:(\d+)/)[1],size:n.size})):d.hide()}else d.hide()}),i.message.listen("update_livp_control_button",function(i){e.updateLivpControlButton(i)})},m.prototype.updateLivpControlButton=function(e){var i,t=a(m.q.livephotoControl),o=a(m.q.livephotoTip),l=a(m.q.livephotoIcon);try{i=a.parseJSON(s.getItem(n()))||{}}catch(r){i={}}switch(e){case"show-loading":t.show(),l.removeClass().addClass("livp-icon start-loading").attr("title","");break;case"show-not-loading":t.show(),l.removeClass().addClass("livp-icon").attr("title","开始播放");break;case"loaded-and-not-play":t.show(),l.removeClass().addClass("livp-icon loaded-and-not-play").attr("title","开始播放");break;case"show-play-tip":var d=/ie|edge/.test(this.checkBrowser)?"点击播放实况照片":"在此关闭自动播放";o.find(".livp-tip-text").html(d),o.find(".tip-triangle").css("left",72),o.css({width:160,left:-55}).show(),i.hideButtonTip=1,s.setItem(n(),a.stringify(i));break;case"hide-play-tip":o.hide();break;case"hide":t.hide();break;case"play_from_loading":t.show();var c="livp-icon ";c+=(/ie|edge/.test(this.checkBrowser)?"ie-":"")+"livp-play-from-loading",l.removeClass().addClass(c).attr("title","暂停播放");break;case"error":t.show(),l.removeClass().addClass("livp-icon livp-error").attr("title","实况照片加载失败");break;case"not-support":t.show(),l.removeClass().addClass("livp-icon livp-not-support").attr("title","浏览器版本过低，不支持播放实况照片");break;case"not-support-tip":i.hideButtonTip=1,s.setItem(n(),a.stringify(i)),o.find(".livp-tip-text").html("浏览器版本过低，不支持播放实况照片"),o.find(".tip-triangle").css("left",125),o.css({width:260,left:-108}).toggle()}},m.prototype.delayChangeImg=function(e){var i=this;null!=i._mKeyboardTimer&&clearTimeout(i._mKeyboardTimer),i._mKeyboardTimer=setTimeout(function(){i._mKeyboardTimer=null,i.dispatchOnKeyboardEvent(e)},i.constructor.MOUSE_KEYBOARD_DELAY_TIME)},m.prototype.changeImgAnimation=function(e){this.triggerEvent("change_picture",e)},m.prototype.setUsingMotionSensor=function(e){if(e){var i=l().tools.motionSensor,t=new i(a('div[node-type="img-nav"]')[0],i.HORIZONTAL),o=this;t.onMotion=function(e,i,t){o._mMotionAccept||(o.changeImgAnimation(t>0?-1:1),o._mMotionAccept=!0)},t.onMotionStart=function(){o._mMotionAccept=!1},t.onMotionEnd=function(){o._mMotionAccept=!1},t.install()}},m.prototype.triggerEvent=function(e,i){l().message.trigger(e,i)},m.prototype.clearReader=function(e){var i=this;"keepCanvas"===e?i.dialog.hide("keepCanvas"):i.dialog.hide(),this.triggerEvent("close_picPreview_success")},m.prototype.onVisibilityChange=function(){var e=this,i=l().tools.keyGuard,t=new i;this._mMotionSensor?this.setUsingMotionSensor(!0):e.dialog.isVisible()?t.acquire(this._mKeyguardListener,!0):this._mKeyguardListener&&t.release(this._mKeyguardListener)},m.prototype.constructor=m,m.prototype.showPicture=function(e){e.list[e.index];m.buildDialog(e)},t.exports={showPicture:function(e){var i=e.list[e.index];m.buildDialog(e),m.picPreviewAside.init(e),l().message.trigger("img_showAside",{file:i,hideMeta:e.hideMeta||!1}),l().message.trigger("changeToolbar",e.index)},getFileData:function(e,i){return m.getFileData(e,i)}}});
;define("file-widget-1:image/start.js",function(e,t,i){var s=e("base:widget/libs/jquerypacket.js"),r=e("base:widget/storage/storage.js"),o=e("base:widget/report-utils/report-util.js"),n=e("file-widget-1:image/context.js"),l=e("file-widget-1:image/util/picPreview/picPreview.js"),a=e("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js"),c=e("file-widget-1:image/util/showPic/log.js"),g={CATEGORY_PIC:3,picFileList:[],newArray:[],timerId:"",reportList:[],time:6e4,resetPicFileList:function(){this.picFileList=[]},showPic:function(e,t,i){var s=this,r=n.getContext(),o=i?i:r.list.getCurrentList()||[e],a=n.getContext().pageInfo.currentPage,c=a&&/^share-/.test(a);this.resetPicFileList();for(var g,p=0,f=0,u=0;u<o.length;u++)g=o[u],+g.category===this.CATEGORY_PIC&&(this.picFileList.push(g),g===e&&(f=p),p++);"unzip"===t&&(f=0,this.picFileList.push(e)),l.showPicture({index:f,list:s.picFileList,hideMeta:c,from:t})},addListen:function(){var e=n.getContext();e.message.listen("delete_picPreview",function(t){function i(){var e=parseInt(t.index,10);g.newArray=[];for(var i=0;i<r.length;i++)i!==e&&g.newArray.push(r[i])}var r=g.newArray.length>0?g.newArray:g.picFileList;if(window.location.href.indexOf("disk/timeline")>0)"function"==typeof g.refresh&&(i(),g.refresh([t.file]));else{i();var o=e.list.getIndexsByFiles([t.file]);o.length&&(e.file.remove(o),e.list.refresh())}return 0===g.newArray.length?(s(".dlg-img-close").click(),!1):void t.callback(g.newArray)})},getApiVersion:function(){if(null===n.getVersion()){var e="api_version_"+n.getContext().locals.get("uk"),t=new RegExp("^true_\\d*$"),i=t.test(r.getItem(e));i?n.setVersion(i):s.ajax({url:"/aipic/image/config",dataType:"json",async:!1,timeout:3e3,success:function(e){n.setVersion(e.newversion)},error:function(){n.setVersion(null)}})}},picReport:function(e){g.reportList.length>0&&o.browserReport(e),g.reportList=[],g.timerId&&clearTimeout(g.timerId),g.timerId=setTimeout(function(){g.timerId="",g.picReport(g.reportList)},g.time)}};i.exports.start=function(e,t){n.setContext(e),g.getApiVersion(),g.newArray=[];var i=[],s=null,r=window.location.pathname,o=["/disk/share","/disk/home","/disk/timeline"];if(i="object"==typeof t&&t.filesList?t.filesList.length>0?t.filesList:[t.filesList]:e.list.getSelected(),"object"==typeof t&&t.refresh&&(g.refresh=t.refresh),r&&o.indexOf(r)>-1){i.length>=1&&g.reportList.push(i[0]),g.timerId=setTimeout(function(){g.timerId="",g.picReport(g.reportList)},g.time),n.getContext().message.listen("changePic",function(e){g.reportList.length<20?g.reportList.push(e):g.picReport(g.reportList)}),n.getContext().message.listen("close_picPreview_success",function(){g.picReport(g.reportList),clearTimeout(g.timerId),n.getContext().message.remove("changePic")})}if(!(i.length>=1))throw new Error("[Plugin][preview/image] The filesList must have one file at least !");return s=i[0],"classify"===t.from?new a(i):(c.sendlog("imgPlayerDis",c.getCommonLogParam(s)),c.sendlog("saveImgGuideDis",c.getCommonLogParam(s)),"object"==typeof t?g.showPic(s,t.from,t.listsData):g.showPic(s),void(e.message.exist("delete_picPreview")||g.addListen()))}});